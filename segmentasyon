import torch
from torchvision import models, transforms
from PIL import Image
import matplotlib.pyplot as plt
import numpy as np

# 1. Görüntüyü yükle
image = Image.open("people.jpg").convert("RGB")

# 2. Transform işlemleri
preprocess = transforms.Compose([
    transforms.Resize(520),
    transforms.ToTensor(),
    transforms.Normalize(mean=[0.485, 0.456, 0.406],
                         std=[0.229, 0.224, 0.225]),
])

input_tensor = preprocess(image).unsqueeze(0)  # Batching

# 3. Modeli yükle (semantic segmentation için)
model = models.segmentation.deeplabv3_resnet50(pretrained=True)
model.eval()

with torch.no_grad():
    output = model(input_tensor)['out'][0]
    output_predictions = output.argmax(0)  # piksel sınıfı

# 4. Renkli maske oluştur
colors = np.random.randint(0, 255, (21, 3), dtype=np.uint8)
segmentation_map = colors[output_predictions.numpy()]

# 5. Görüntü göster
plt.figure(figsize=(12, 5))
plt.subplot(1, 2, 1)
plt.title("Orijinal Görüntü")
plt.imshow(image)
plt.axis("off")

plt.subplot(1, 2, 2)
plt.title("Semantic Segmentation")
plt.imshow(segmentation_map)
plt.axis("off")
plt.show()
